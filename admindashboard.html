<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard Admin</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { margin:0; font-family:Arial,sans-serif; background:#1e1e2f; color:#fff; }
    header { background:#2b2b4f; padding:10px 20px; display:flex; justify-content:space-between; align-items:center; }
    header h1 { margin:0; font-size:1.5em; }
    #hamburger { cursor:pointer; font-size:1.5em; }

    #sidebar { position:fixed; left:0; top:50px; width:200px; height:calc(100%-50px); background:#2b2b4f; padding:20px; display:flex; flex-direction:column; gap:15px; }
    #sidebar .locked { display:flex; align-items:center; gap:5px; color:#888; cursor:not-allowed; }

    main { margin:20px; margin-left:220px; }
    table { width:100%; border-collapse:collapse; margin-top:20px; }
    th, td { padding:10px; border:1px solid #444; text-align:left; }
    th { background:#333366; }
    .score-low { color:#ff4d4d; font-weight:bold; }
    .score-medium { color:#ffcc00; font-weight:bold; }
    .score-high { color:#00ff88; font-weight:bold; }

    #charts { display:flex; flex-wrap:wrap; gap:20px; margin-top:20px; }
    .chart-box { flex:1 1 300px; background:#2b2b4f; padding:20px; border-radius:10px; }

    #logs { background:#2b2b4f; padding:20px; border-radius:10px; margin-top:20px; max-height:200px; overflow-y:auto; }

    @media(max-width:768px){
        #sidebar { left:-220px; transition:left 0.3s; top:0; height:100%; }
        #sidebar.open { left:0; }
        main { margin-left:0; }
    }
</style>
</head>
<body>

<header>
    <h1>Dashboard Admin</h1>
    <div id="hamburger">â˜°</div>
</header>

<div id="sidebar">
    <div class="locked">ðŸ”’ Indisponible</div>
    <div class="locked">ðŸ”’ Indisponible</div>
    <div class="locked">ðŸ”’ Indisponible</div>
</div>

<main>
    <h2>Utilisateurs</h2>
    <table>
        <thead>
            <tr><th>IP / Utilisateur</th><th>Points</th><th>Score comportemental</th></tr>
        </thead>
        <tbody id="usersTable"></tbody>
    </table>

    <h2>Graphiques</h2>
    <div id="charts">
        <div class="chart-box"><canvas id="connectionChart"></canvas></div>
    </div>

    <h2>Logs</h2>
    <div id="logs"></div>
</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
function scoreClass(points){
    if(points<=30) return 'score-low';
    if(points<=70) return 'score-medium';
    return 'score-high';
}

async function fetchUsers(){
    const res = await fetch('/api/users'); // ton endpoint serveur
    return res.ok ? await res.json() : [];
}

async function fetchLogs(){
    const res = await fetch('/api/logs'); // ton endpoint serveur
    return res.ok ? await res.json() : [];
}

function updateUsersTable(users){
    const usersTable = document.getElementById("usersTable");
    usersTable.innerHTML = "";
    users.forEach(u=>{
        const displayName = u.name ? `${u.ip} <${u.name}>` : `${u.ip} (non connectÃ©)`;
        const points = Math.min(100, Math.max(0, u.points));
        const row = document.createElement("tr");
        row.innerHTML = `<td>${displayName}</td><td>${points}</td><td class="${scoreClass(points)}">${points}</td>`;
        usersTable.appendChild(row);
    });
}

function updateLogs(logs){
    const logsDiv = document.getElementById("logs");
    logsDiv.innerHTML = "";
    logs.forEach(l=>{
        const div = document.createElement("div");
        div.textContent = l;
        logsDiv.appendChild(div);
    });
}

async function refreshDashboard(){
    const users = await fetchUsers();
    updateUsersTable(users);

    const logs = await fetchLogs();
    updateLogs(logs);

    const connectionChartData = [users.filter(u=>u.name).length, users.filter(u=>!u.name).length];
    connectionChart.data.datasets[0].data = connectionChartData;
    connectionChart.update();
}

// Graphique connections
const connectionCtx = document.getElementById('connectionChart').getContext('2d');
const connectionChart = new Chart(connectionCtx, {
    type: 'doughnut',
    data: { labels:['ConnectÃ©','Non connectÃ©'], datasets:[{ data:[0,0], backgroundColor:['#00ff88','#ff4d4d'] }] },
    options:{ responsive:true }
});

// Refresh toutes les 3s
refreshDashboard();
setInterval(refreshDashboard, 3000);

// Hamburger mobile
const hamburger = document.getElementById("hamburger");
const sidebar = document.getElementById("sidebar");
hamburger.addEventListener("click", ()=> sidebar.classList.toggle("open"));
</script>

</body>
</html>

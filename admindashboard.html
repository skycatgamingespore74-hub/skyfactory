<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Dashboard</title>

<style>
* { box-sizing:border-box; }
body { margin:0; font-family:Arial,sans-serif; background:#020617; color:white; }
header { background:#1e293b; padding:20px; }
nav a { color:#38bdf8; margin-right:15px; text-decoration:none; }
.container { padding:30px; }
.card { background:#1e293b; padding:20px; border-radius:8px; margin-bottom:20px; }
button { padding:10px 15px; border:none; background:#2563eb; color:white; border-radius:5px; cursor:pointer; }
input { padding:10px; width:100%; margin-bottom:10px; }
footer { background:#020617; text-align:center; padding:15px; opacity:0.6; }

/* ===================== Bande de connexion serveur ===================== */
#server-status-bar {
    width: 100%;
    padding: 10px;
    text-align: center;
    font-weight: bold;
    color: white;
    background-color: #ff0000; /* rouge */
    position: fixed;
    top: 0;
    left: 0;
    z-index: 1000;
}
body.connected #server-status-bar { background-color: #4ade80; } /* vert si connecté */
body.disconnected #server-status-bar { background-color: #ff0000; } /* rouge si non connecté */
body { padding-top: 40px; } /* espace pour la bande */
</style>

</head>
<body>

<!-- Bande serveur -->
<div id="server-status-bar">Vérification connexion serveur...</div>

<header>
<h1>Bot Platform</h1>
<nav>
<a href="index.html">Accueil</a>
<a href="bots.html">Nos bots</a>
<a href="equipe.html">Équipe</a>
<a href="credits.html">Crédits</a>
<a href="connexion.html">Connexion</a>
</nav>
</header>

<div class="container">
<div class="card">
<h2 id="dashboardTitle">Dashboard</h2>
<p>Crédits : <span id="credits">0</span></p>
</div>
<div class="card">
<button onclick="window.location.href='boutique.html'">Boutique</button>
<button onclick="window.location.href='profil.html'">Profil</button>
<button id="logoutBtn">Déconnexion</button>
</div>
</div>

<footer>
© 2026 Bot Platform – Tous droits réservés
</footer>

<script>
(async () => {
    const serverBar = document.getElementById('server-status-bar');
    const sessionId = localStorage.getItem('adminSessionId');

    if (!sessionId) {
        alert("Session non trouvée, connectez-vous !");
        window.location.href = 'connexion.html';
        return;
    }

    try {
        const res = await fetch('https://serveur-site-production-97d2.up.railway.app/admin/session-check', {
            method: 'GET',
            headers: { 'sessionid': sessionId }
        });

        const data = await res.json();

        if (!res.ok || !data.success) {
            alert("Session invalide, reconnectez-vous !");
            localStorage.removeItem('adminSessionId');
            window.location.href = 'connexion.html';
            return;
        }

        // Serveur connecté
        serverBar.textContent = "✅ Serveur connecté";
        document.body.classList.add('connected');

        // Affiche le nom de l'admin
        document.getElementById('dashboardTitle').textContent = `Dashboard - ${data.username}`;

        // Si super-admin, afficher info spéciale
        if (data.isSuperAdmin) {
            const superCard = document.createElement('div');
            superCard.classList.add('card');
            superCard.innerHTML = `<h3>Super Admin Mode</h3><p>Accès complet activé</p>`;
            document.querySelector('.container').appendChild(superCard);
        }

    } catch (err) {
        console.error('Erreur dashboard:', err);
        serverBar.textContent = "❌ Impossible de contacter le serveur";
        document.body.classList.add('disconnected');
    }

    // Déconnexion
    document.getElementById('logoutBtn').addEventListener('click', async () => {
        try {
            await fetch('https://serveur-site-production-97d2.up.railway.app/admin/disconnect', {
                method: 'POST',
                headers: { 'sessionid': sessionId }
            });
        } catch (err) {
            console.error('Erreur déconnexion:', err);
        }
        localStorage.removeItem('adminSessionId');
        window.location.href = 'connexion.html';
    });
})();
</script>

</body>
</html>

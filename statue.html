<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>SkyBotFactory - Statut du serveur</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; color: #333; padding: 20px; }
    h1 { color: #2c3e50; }
    .status { font-size: 1.2em; margin-bottom: 15px; }
    .info { margin-bottom: 10px; }
    .logs { background: #fff; padding: 10px; border: 1px solid #ddd; max-height: 200px; overflow-y: auto; margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
    th, td { padding: 8px 12px; border: 1px solid #ddd; text-align: left; }
    th { background: #2c3e50; color: #fff; }
    button { padding: 10px 20px; background: #3498db; color: #fff; border: none; cursor: pointer; }
    button:disabled { background: #95a5a6; cursor: not-allowed; }
</style>
</head>
<body>

<h1>SkyBotFactory - Statut du serveur</h1>

<div class="status">üåê √âtat serveur : <span id="server-status">Chargement...</span></div>
<div class="info">üë§ Nombre d'utilisateurs : <span id="user-count">Chargement...</span></div>
<div class="info">üîë Sessions actives : <span id="session-count">Chargement...</span></div>
<div class="info">üí∞ Cr√©dits distribu√©s : <span id="credits-count">Chargement...</span></div>

<h2>Logs r√©cents :</h2>
<div class="logs" id="logs">Chargement...</div>

<h2>Fonctions disponibles :</h2>
<table>
    <thead>
        <tr>
            <th>Fonction</th>
            <th>M√©thode</th>
            <th>URL</th>
            <th>Statut</th>
        </tr>
    </thead>
    <tbody id="functions-table">
        <!-- Les lignes seront ajout√©es dynamiquement -->
    </tbody>
</table>

<button id="test-button" disabled>Tester une fonction</button>

<script>
const API_URL = "https://serveur-site-production-97d2.up.railway.app";

async function updateStatus() {
    const statusEl = document.getElementById('server-status');
    const userEl = document.getElementById('user-count');
    const sessionEl = document.getElementById('session-count');
    const creditsEl = document.getElementById('credits-count');
    const logsEl = document.getElementById('logs');
    const testBtn = document.getElementById('test-button');

    try {
        const res = await fetch(`${API_URL}/status`);
        if (!res.ok) throw new Error("Serveur indisponible");

        const data = await res.json();

        statusEl.innerText = data.connected ? "‚úÖ Actif" : "‚ùå Inactif";
        userEl.innerText = data.userCount || "0";
        sessionEl.innerText = data.sessionCount || "0";
        creditsEl.innerText = data.creditsDistributed || "0";
        logsEl.innerText = (data.logs && data.logs.length) ? data.logs.join("\n") : "Aucun log r√©cent.";

        // Activer le bouton seulement si le serveur est actif
        testBtn.disabled = !data.connected;

        // Remplir le tableau des fonctions
        const functions = [
            { name: "Inscription", method: "POST", url: "/register" },
            { name: "Connexion", method: "POST", url: "/login" },
            { name: "V√©rifier session", method: "POST", url: "/check-session" },
            { name: "D√©connexion", method: "POST", url: "/logout" },
            { name: "R√©cup√©rer utilisateur", method: "GET", url: "/user/:email" },
            { name: "Mettre √† jour profil", method: "POST", url: "/update" },
            { name: "Acheter cr√©dits", method: "POST", url: "/buy-credits" },
        ];

        const tbody = document.getElementById('functions-table');
        tbody.innerHTML = "";
        for (const fn of functions) {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td>${fn.name}</td>
                <td>${fn.method}</td>
                <td>${fn.url}</td>
                <td>${data.connected ? "‚úÖ Disponible" : "‚ùå Indisponible"}</td>
            `;
            tbody.appendChild(tr);
        }

    } catch (err) {
        console.error(err);
        statusEl.innerText = "‚ùå Inactif";
        userEl.innerText = "N/A";
        sessionEl.innerText = "N/A";
        creditsEl.innerText = "N/A";
        logsEl.innerText = "Impossible de charger les informations du serveur.";
        document.getElementById('test-button').disabled = true;
    }
}

// Mettre √† jour toutes les 10 secondes
updateStatus();
setInterval(updateStatus, 10000);
</script>

</body>
</html>

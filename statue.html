<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SkyBotFactory - Statut</title>
<style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f0f0f0; }
    h1 { color: #333; }
    .stat { margin: 10px 0; padding: 10px; background: #fff; border-radius: 5px; }
    #logs { max-height: 200px; overflow-y: auto; background: #222; color: #0f0; padding: 10px; border-radius: 5px; font-family: monospace; }
    button { margin-top: 20px; padding: 10px 20px; font-size: 16px; cursor: not-allowed; opacity: 0.5; }
</style>
</head>
<body>
<h1>SkyBotFactory - Statut du serveur</h1>

<div class="stat" id="serverStatus">ğŸŒ Ã‰tat serveur : Chargement...</div>
<div class="stat" id="userCount">ğŸ‘¤ Nombre d'utilisateurs : Chargement...</div>
<div class="stat" id="activeSessions">ğŸ”‘ Sessions actives : Chargement...</div>
<div class="stat" id="totalCredits">ğŸ’° CrÃ©dits distribuÃ©s : Chargement...</div>

<h2>Logs rÃ©cents :</h2>
<div id="logs">Chargement des logs...</div>

<button disabled>Tester (Indisponible)</button>

<script>
const API_URL = "https://serveur-site-production-97d2.up.railway.app";

async function loadStatus() {
    try {
        // Ã‰tat serveur
        const statusRes = await fetch(`${API_URL}/status`);
        const statusData = await statusRes.json();
        document.getElementById('serverStatus').innerText = statusData.connected ? "ğŸŒ Ã‰tat serveur : âœ… Actif" : "ğŸŒ Ã‰tat serveur : âŒ Inactif";

        // Utilisateurs
        const usersRes = await fetch(`${API_URL}/users`);
        const usersData = await usersRes.json();
        document.getElementById('userCount').innerText = `ğŸ‘¤ Nombre d'utilisateurs : ${usersData.length}`;

        // Sessions (tokens)
        const tokensRes = await fetch(`${API_URL}/tokens`); // on ajoutera route tokens cÃ´tÃ© serveur
        const tokensData = await tokensRes.json();
        document.getElementById('activeSessions').innerText = `ğŸ”‘ Sessions actives : ${Object.keys(tokensData).length}`;

        // Total crÃ©dits
        const totalCredits = usersData.reduce((sum, u) => sum + (u.credits || 0), 0);
        document.getElementById('totalCredits').innerText = `ğŸ’° CrÃ©dits distribuÃ©s : ${totalCredits}`;

        // Logs rÃ©cents
        const logsRes = await fetch(`${API_URL}/logs`); // route logs cÃ´tÃ© serveur
        const logsData = await logsRes.json();
        document.getElementById('logs').innerText = logsData.join('\n');

    } catch (err) {
        console.error(err);
        document.getElementById('logs').innerText = "âŒ Impossible de charger les informations du serveur";
    }
}

// Recharge toutes les 10 secondes
loadStatus();
setInterval(loadStatus, 10000);
</script>
</body>
</html>
